<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AVD CRASH</title>

<!-- Import Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Bungee+Spice&family=Honk&family=Tagesschrift&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;}
body{
  margin:0;
  background:#0d1117;
  color:#fff;
  overflow-x:hidden;
  height:100vh;
  font-family:'Tagesschrift', system-ui;
}
.bg-video{
  position:fixed;
  top:0;left:0;
  min-width:100%;
  min-height:100%;
  object-fit:cover;
  z-index:-1;
  filter:brightness(0.4);
}
header{
  background:rgba(22,27,34,0.8);
  padding:15px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  position:fixed;
  width:100%;
  top:0;left:0;
  box-shadow:0 0 10px #ff0000;
  z-index:10;
  backdrop-filter:blur(10px);
}
.menu-icon{font-size:24px;cursor:pointer;color:#ff0000;}
.container{
  margin-top:90px;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
  text-align:center;
  min-height:calc(100vh - 100px);
}

/* ======== FONT CUSTOM ======== */
.honk {
  font-family: "Honk", system-ui;
  font-optical-sizing: auto;
  font-weight: 400;
  font-style: normal;
  color: #ff0000;
  text-shadow: 0 0 15px #ff0000;
}
.bungee-spice-regular {
  font-family: "Bungee Spice", sans-serif;
  font-weight: 400;
  font-style: normal;
}
.tagesschrift-regular {
  font-family: "Tagesschrift", system-ui;
  font-weight: 400;
  font-style: normal;
}

/* ======== Transisi Halus ======== */
.fade {
  opacity:0;
  transform:translateY(20px);
  transition:opacity 0.5s ease, transform 0.5s ease;
}
.fade.active {
  opacity:1;
  transform:translateY(0);
}

/* ======== Ukuran Seragam Semua Halaman ======== */
.page-box{
  background:rgba(22,27,34,0.8);
  padding:25px;
  border-radius:12px;
  box-shadow:0 0 15px #ff0000;
  width:100%;
  max-width:720px;
  text-align:center;
  backdrop-filter:blur(10px);
  margin:0 auto;
}

/* Home video rapih */
.welcome-video{
  width:100%;
  max-width:400px;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 0 12px #ff0000;
  margin-bottom:15px;
}
.welcome-video video{
  width:100%;
  height:auto;
  display:block;
  border-radius:12px;
}

h1{
  color:#ff0000;
  font-size:24px;
  text-shadow:0 0 15px #ff0000;
  margin-bottom:10px;
}
p{color:#ccc;font-size:0.95rem;margin-bottom:15px;}

/* Music Player */
#music-player{
  position:relative;
  margin-top:10px;
  background:rgba(0,0,0,0.6);
  padding:12px 20px;
  border-radius:30px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
  color:#ff0000;
  font-size:1rem;
  box-shadow:0 0 15px #ff0000,0 0 30px #ff3333;
  width:100%;
  max-width:320px;
  animation:pulseRed 2s infinite alternate;
}
@keyframes pulseRed{0%{box-shadow:0 0 10px #ff0000;}100%{box-shadow:0 0 25px #ff3333;}}
#music-controls{display:flex;align-items:center;gap:10px;}
#music-player button{background:none;border:none;color:#ff0000;font-size:1.2rem;cursor:pointer;text-shadow:0 0 6px #ff0000;}
#progressContainer{width:280px;height:6px;background:rgba(255,255,255,0.2);border-radius:3px;overflow:hidden;cursor:pointer;}
#progressBar{width:0%;height:100%;background:linear-gradient(90deg,#ff0000,#ff3333);border-radius:3px;transition:width 0.1s linear;}
#timeDisplay{font-size:0.8rem;color:#ff5555;font-weight:bold;margin-top:4px;}
.equalizer{display:flex;gap:3px;align-items:flex-end;height:16px;margin-top:4px;}
.bar{width:3px;background:#ff0000;box-shadow:0 0 4px #ff3333;border-radius:1px;animation:bounce 1s infinite;}
.bar:nth-child(1){animation-delay:0s;}
.bar:nth-child(2){animation-delay:0.15s;}
.bar:nth-child(3){animation-delay:0.3s;}
.bar:nth-child(4){animation-delay:0.45s;}
.bar:nth-child(5){animation-delay:0.6s;}
@keyframes bounce{0%,100%{height:4px;}50%{height:16px;}}
.equalizer.paused .bar{animation-play-state:paused;}

/* JAM DIGITAL */
#digitalClock{
  margin-top:10px;
  font-family:'Orbitron',sans-serif;
  font-size:1.2rem;
  color:#ff0000;
  text-shadow:0 0 15px #ff0000;
}

.sidebar{
  position:fixed;
  top:0;
  right:-280px;
  width:280px;
  height:100%;
  background:rgba(22,27,34,0.95);
  box-shadow:-4px 0 10px #ff0000;
  transition:right 0.3s ease;
  padding-top:60px;
  z-index:20;
  backdrop-filter:blur(10px);
}
.sidebar.active{right:0;}
.sidebar .userbox{display:block;padding:15px;color:#ff4444;font-weight:bold;border-bottom:1px solid rgba(255,0,0,0.06);}
.sidebar a{
  display:block;
  color:#fff;
  padding:15px 25px;
  text-decoration:none;
  border-bottom:1px solid #0d1117;
}
.sidebar a:hover{background:#ff0000;color:#fff;}
input,textarea,select,button{
  font-family:'Tagesschrift', system-ui;
  width:90%;
  padding:10px;
  margin-top:10px;
  border-radius:8px;
  border:none;
  background:#0d1117;
  color:#fff;
}
button{
  margin-top:20px;
  background:#ff0000;
  color:#fff;
  padding:12px 20px;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
  width:95%;
  box-shadow:0 0 10px #ff0000;
  transition:0.3s;
}
button:hover{background:#cc0000;transform:scale(1.05);}
.status{margin-top:15px;font-weight:bold;min-height:24px;}
.link-buttons{margin-top:15px;display:flex;justify-content:space-around;gap:10px;flex-wrap:wrap;}
.link-buttons a{
  flex:1;
  text-align:center;
  padding:10px;
  background:#ff0000;
  border-radius:8px;
  color:#fff;
  font-weight:bold;
  text-decoration:none;
  box-shadow:0 0 10px #ff0000;
  transition:0.3s;
}
.link-buttons a:hover{background:#cc0000;transform:scale(1.05);}
.table{width:100%;border-collapse:collapse;margin-top:10px;}
.table th,.table td{padding:8px;border:1px solid rgba(255,255,255,0.06);font-size:0.9rem;}
.small{font-size:0.85rem;color:#ccc;}
@media(max-width:480px){h1{font-size:20px;}.page-box{width:95%;padding:20px;}}
</style>
</head>
<body>

<video autoplay muted loop class="bg-video">
  <source src="https://files.catbox.moe/58by2h.mp4" type="video/mp4">
</video>

<header>
  <h2 class="honk">AVD CRASH</h2>
  <div class="menu-icon tagesschrift-regular" onclick="toggleSidebar()">‚ò∞</div>
</header>

<audio id="bgMusic" autoplay loop></audio>

<div id="content" class="container fade active">

  <!-- LOGIN PAGE (default visible) -->
  <div id="loginPage" class="page-box">
    <h2 class="bungee-spice-regular">Login</h2>
    <input type="text" id="loginUser" placeholder="Username">
    <input type="password" id="loginPass" placeholder="Password">
    <button onclick="checkLogin()">Login</button>
    <div class="status" id="loginStatus"></div>
    <p class="small">buy key pv @AVDOW3</p>
  </div>

</div>

<div class="sidebar" id="sidebar">
  <div class="userbox">
    User: <span id="sideUser">-</span><br>
    Level: <span id="sideLevel">-</span>
  </div>
  <a href="#" onclick="loadPage('home')">üè† Home</a>
  <a href="#" onclick="loadPage('token')">üîë Bot Token</a>
  <a href="#" onclick="loadPage('dashboard')">ü¶† Attack</a>
  <a href="#" id="adminLink" style="display:none;" onclick="loadPage('admin')">‚öôÔ∏è Admin Panel</a>
  <a href="#" onclick="logout()">üö™ Logout</a>
</div>

<script>
/* ================== USER STORAGE & SEED ================== */
/*
  User object:
  { user: "owner", pass: "hellowhatsappinstagram", level: "ADMIN", expires: null }
  expires: timestamp in ms, or null for never expire
*/

const defaultUsers = [
  { user: "owner", pass: "hellowhatsappinstagram", level: "ADMIN", expires: null },
  { user: "vip", pass: "8888", level: "VIP", expires: null },
  { user: "trial", pass: "0000", level: "TRIAL", expires: null }
];

function loadUsersFromStorage(){
  let raw = localStorage.getItem("avd_users");
  if(!raw){
    localStorage.setItem("avd_users", JSON.stringify(defaultUsers));
    return JSON.parse(JSON.stringify(defaultUsers));
  }
  try{
    return JSON.parse(raw) || [];
  }catch(e){
    localStorage.setItem("avd_users", JSON.stringify(defaultUsers));
    return JSON.parse(JSON.stringify(defaultUsers));
  }
}

function saveUsersToStorage(arr){
  localStorage.setItem("avd_users", JSON.stringify(arr));
}

/* =============== PAGE + SIDEBAR + LOGIN =============== */

let botToken="";
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('active');}

function updateSidebarInfo(){
  const u = localStorage.getItem("avd_user") || "-";
  const l = localStorage.getItem("avd_level") || "-";
  document.getElementById("sideUser").textContent = u;
  document.getElementById("sideLevel").textContent = l;

  // show admin link only for ADMIN
  const adminLink = document.getElementById("adminLink");
  if(l === "ADMIN") adminLink.style.display = "block"; else adminLink.style.display = "none";
}

/* loadPage kept compatible with original structure */
function loadPage(page){
  const content=document.getElementById("content");
  content.classList.remove('active');
  // update sidebar info every time
  updateSidebarInfo();

  setTimeout(()=>{
    document.getElementById('sidebar').classList.remove('active');

    // if login page still visible and not logged in, prevent loading other pages
    if(localStorage.getItem("avd_login") !== "true"){
      // keep login visible
      document.getElementById("loginPage").style.display = "block";
      setTimeout(()=>content.classList.add('active'),100);
      return;
    }

    if(page==='home'){
      content.innerHTML=`
      <div class="page-box">
        <div class="welcome-video">
          <video autoplay muted loop><source src="https://files.catbox.moe/9z0eru.mp4" type="video/mp4"></video>
        </div>
        <h1 class="bungee-spice-regular">Welcome to AVD CRASH</h1>
        <p class="tagesschrift-regular">Tekan garis tiga di kanan atas untuk mula.</p>
        <div id="music-player">
          <div id="music-controls">
            <button id="prevBtn">‚èÆÔ∏è</button>
            <button id="playPauseBtn">‚ñ∂Ô∏è</button>
            <button id="nextBtn">‚è≠Ô∏è</button>
          </div>
          <div class="equalizer" id="equalizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
          <div id="progressContainer"><div id="progressBar"></div></div>
          <div id="timeDisplay">00:00 / 00:00</div>
          <div id="digitalClock"></div>
        </div>
      </div>`;
      setupMusic();startClock();
    }

    if(page==='token'){
      content.innerHTML=`<div class="page-box">
      <h2 class="bungee-spice-regular">Masukkan Bot Token</h2>
      <input type="text" id="tokenInput" placeholder="Masukkan token dari BotFather">
      <button onclick="saveToken()">enter</button>
      <div class="status" id="statusToken"></div>
      <div class="link-buttons">
        <a href="https://t.me/BotFather" target="_blank">BotFather</a>
        <a href="https://t.me/AVDOW3" target="_blank">Developer</a>
      </div></div>`;
    }

    if(page==='dashboard'){
      content.innerHTML=`<div class="page-box"><h2 class="bungee-spice-regular"> AVD CRASH MENU</h2>
      <form id="telegramForm">
        <label for="chat_id">ID Target:</label><br>
        <input type="text" id="chat_id" placeholder="contoh: 123456789" required><br><br>
        <label for="type">Type Attack:</label><br>
        <select id="type" required>
          <option value="text">Teks</option>
          <option value="photo">Gambar</option>
          <option value="sticker">Sticker</option>
          <option value="voice">Voice</option>
          <option value="document">Dokumen</option>
          <option value="location">Lokasi</option>
        </select><br><br>
        <div id="inputArea">
          <label for="text">Keterangan:</label><br>
          <textarea id="text" rows="5" placeholder="Tulis Teks di sini..." required></textarea>
        </div><br>
        <label for="jumlah">Jumlah:</label><br>
        <input id="jumlah" type="number" min="1" placeholder="Contoh: 1" required>
        <button type="submit">Send Attack</button>
        <div class="status" id="status"></div>
      </form></div>`;
      setupDashboard();
    }

    if(page==='admin'){
      // only ADMIN can access admin page (double-check)
      const lvl = localStorage.getItem("avd_level");
      if(lvl !== "ADMIN"){
        content.innerHTML = `<div class="page-box"><h2 class="bungee-spice-regular">Akses Ditolak</h2><p class="small">Hanya ADMIN boleh mengakses panel ini.</p></div>`;
      } else {
        content.innerHTML = `
        <div class="page-box">
          <h2 class="bungee-spice-regular">ADMIN PANEL - Pengurusan Users</h2>
          <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px;">
            <input id="newUser" placeholder="username" style="width:28%"><input id="newPass" placeholder="password" style="width:28%">
            <select id="newLevel" style="width:18%"><option>ADMIN</option><option>VIP</option><option>TRIAL</option></select>
            <input id="newExpire" placeholder="expire (days) or 0" style="width:18%">
            <button onclick="adminAddUser()">Tambah</button>
          </div>

          <div id="adminMsg" class="status"></div>

          <table class="table" id="usersTable">
            <thead><tr><th>User</th><th>Level</th><th>Expires</th><th>Aksi</th></tr></thead>
            <tbody></tbody>
          </table>

          <div style="margin-top:12px;">
            <button onclick="seedDefaults()">Reset ke Default Users</button>
            <button onclick="exportUsers()">Export JSON</button>
            <button onclick="importPrompt()">Import JSON</button>
          </div>
        </div>`;
        renderUsersTable();
      }
    }

    setTimeout(()=>content.classList.add('active'),100);
  },300);
}

/* ================= Music + Clock (kept from original) ================= */
let music=document.getElementById('bgMusic');
let isPlaying=false,currentTrack=0;
const playlist=["https://files.catbox.moe/3255eb.mp3","https://files.catbox.moe/5nnd5p.mp3"];
function loadTrack(index){music.src=playlist[index];music.load();music.play();}
loadTrack(currentTrack);

function setupMusic(){
  const playPauseBtn=document.getElementById('playPauseBtn');
  const prevBtn=document.getElementById('prevBtn');
  const nextBtn=document.getElementById('nextBtn');
  const equalizer=document.getElementById('equalizer');
  const progressBar=document.getElementById('progressBar');
  const progressContainer=document.getElementById('progressContainer');
  const timeDisplay=document.getElementById('timeDisplay');
  function formatTime(sec){const m=Math.floor(sec/60)||0;const s=Math.floor(sec%60)||0;return`${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;}
  if(!playPauseBtn) return;
  playPauseBtn.addEventListener('click',()=>{isPlaying?music.pause():music.play();});
  music.addEventListener('play',()=>{isPlaying=true;playPauseBtn.textContent='‚è∏Ô∏è';equalizer.classList.remove('paused');});
  music.addEventListener('pause',()=>{isPlaying=false;playPauseBtn.textContent='‚ñ∂Ô∏è';equalizer.classList.add('paused');});
  nextBtn.addEventListener('click',()=>{currentTrack=(currentTrack+1)%playlist.length;loadTrack(currentTrack);});
  prevBtn.addEventListener('click',()=>{currentTrack=(currentTrack-1+playlist.length)%playlist.length;loadTrack(currentTrack);});
  music.addEventListener('timeupdate',()=>{const p=(music.currentTime/music.duration)*100||0;progressBar.style.width=p+'%';timeDisplay.textContent=`${formatTime(music.currentTime)} / ${formatTime(music.duration)}`;});
  progressContainer.addEventListener('click',e=>{const rect=progressContainer.getBoundingClientRect();const clickX=e.clientX-rect.left;const newTime=(clickX/rect.width)*music.duration;music.currentTime=newTime;});
}

function startClock(){
  const clock=document.getElementById('digitalClock');
  if(!clock) return;
  function updateClock(){const now=new Date();const h=String(now.getHours()).padStart(2,'0');const m=String(now.getMinutes()).padStart(2,'0');const s=String(now.getSeconds()).padStart(2,'0');clock.textContent=`${h}:${m}:${s}`;}
  updateClock();setInterval(updateClock,1000);
}

/* ================= LOGIN (uses users from storage) ================= */

window.addEventListener('load', () => {
  // If logged in and session valid (not expired), hide login and show home
  validateSessionOnLoad();
  updateSidebarInfo();
});

function validateSessionOnLoad(){
  const logged = localStorage.getItem("avd_login") === "true";
  if(!logged) {
    document.getElementById("loginPage").style.display = "block";
    return;
  }
  // check expiry of the logged user
  const currentUser = localStorage.getItem("avd_user");
  const users = loadUsersFromStorage();
  const found = users.find(u => u.user === currentUser);
  if(found){
    if(found.expires && Date.now() > found.expires){
      // expired
      localStorage.removeItem("avd_login");
      localStorage.removeItem("avd_user");
      localStorage.removeItem("avd_level");
      document.getElementById("loginPage").style.display = "block";
      alert("Akaun anda telah tamat tempoh.");
      return;
    } else {
      document.getElementById("loginPage").style.display = "none";
      loadPage("home");
      return;
    }
  } else {
    // user not found
    localStorage.removeItem("avd_login");
    localStorage.removeItem("avd_user");
    localStorage.removeItem("avd_level");
    document.getElementById("loginPage").style.display = "block";
  }
}

function checkLogin(){
  const u = document.getElementById("loginUser").value.trim();
  const p = document.getElementById("loginPass").value.trim();
  const status = document.getElementById("loginStatus");
  const users = loadUsersFromStorage();

  const found = users.find(x => x.user === u && x.pass === p);
  if(found){
    // check expiry
    if(found.expires && Date.now() > found.expires){
      status.textContent = "‚ùå Akaun telah tamat tempoh.";
      status.style.color = "red";
      return;
    }

    status.textContent = `‚úÖ Login Berjaya (${found.level})`;
    status.style.color = "lightgreen";

    localStorage.setItem("avd_login", "true");
    localStorage.setItem("avd_user", found.user);
    localStorage.setItem("avd_level", found.level);

    setTimeout(()=>{
      document.getElementById("loginPage").style.display = "none";
      loadPage("home");
      updateSidebarInfo();
    }, 400);
  } else {
    status.textContent = "‚ùå Username atau Password salah!";
    status.style.color = "red";
  }
}

function logout(){
  localStorage.removeItem("avd_login");
  localStorage.removeItem("avd_user");
  localStorage.removeItem("avd_level");
  // show login
  document.getElementById("loginPage").style.display = "block";
  updateSidebarInfo();
}

/* ================= ADMIN PANEL FUNCTIONS ================= */

function renderUsersTable(){
  const users = loadUsersFromStorage();
  const tbody = document.querySelector("#usersTable tbody");
  tbody.innerHTML = "";
  users.forEach((u, idx) => {
    const tr = document.createElement("tr");
    const expText = u.expires ? new Date(u.expires).toLocaleString() : "Never";
    tr.innerHTML = `
      <td>${u.user}</td>
      <td>${u.level}</td>
      <td>${expText}</td>
      <td>
        <button onclick="adminEditUser(${idx})">Edit</button>
        <button onclick="adminDeleteUser(${idx})">Hapus</button>
        <button onclick="adminSetExpirePrompt(${idx})">Set Expire</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function adminAddUser(){
  const un = document.getElementById("newUser").value.trim();
  const pw = document.getElementById("newPass").value.trim();
  const lvl = document.getElementById("newLevel").value;
  const exp = parseFloat(document.getElementById("newExpire").value) || 0;
  const msg = document.getElementById("adminMsg");
  if(!un || !pw){ msg.textContent = "Sila isi username & password"; msg.style.color="orange"; return; }

  let users = loadUsersFromStorage();
  if(users.find(u=>u.user===un)){ msg.textContent = "Username sudah wujud"; msg.style.color="red"; return; }

  const expires = exp > 0 ? Date.now() + (exp*24*60*60*1000) : null;
  users.push({ user: un, pass: pw, level: lvl, expires });
  saveUsersToStorage(users);
  msg.textContent = "‚úÖ User ditambah";
  msg.style.color="lightgreen";
  document.getElementById("newUser").value=""; document.getElementById("newPass").value=""; document.getElementById("newExpire").value="";
  renderUsersTable();
}

function adminEditUser(idx){
  let users = loadUsersFromStorage();
  const u = users[idx];
  const newUser = prompt("Username:", u.user);
  if(newUser === null) return;
  const newPass = prompt("Password:", u.pass);
  if(newPass === null) return;
  const newLevel = prompt("Level (ADMIN/VIP/TRIAL):", u.level);
  if(newLevel === null) return;

  // ensure username not duplicate (unless same index)
  if(users.some((x,i)=> x.user === newUser && i !== idx)){ alert("Username sudah wujud"); return; }

  users[idx].user = newUser.trim() || users[idx].user;
  users[idx].pass = newPass.trim() || users[idx].pass;
  users[idx].level = newLevel.trim().toUpperCase() || users[idx].level;
  saveUsersToStorage(users);
  renderUsersTable();
}

function adminDeleteUser(idx){
  if(!confirm("Hapus user ini?")) return;
  let users = loadUsersFromStorage();
  const removed = users.splice(idx,1);
  saveUsersToStorage(users);
  renderUsersTable();
  alert("User dihapuskan: " + (removed[0] ? removed[0].user : ""));
}

function adminSetExpirePrompt(idx){
  const days = prompt("Masukkan hari untuk expire (0 = never):", "0");
  if(days === null) return;
  const d = parseFloat(days);
  if(isNaN(d) || d < 0){ alert("Nilai tidak sah"); return; }
  let users = loadUsersFromStorage();
  users[idx].expires = d > 0 ? Date.now() + d*24*60*60*1000 : null;
  saveUsersToStorage(users);
  renderUsersTable();
}

/* seed defaults */
function seedDefaults(){
  if(!confirm("Reset users ke default? Semua custom akan hilang.")) return;
  saveUsersToStorage(defaultUsers);
  renderUsersTable();
}

/* export / import */
function exportUsers(){
  const users = loadUsersFromStorage();
  const data = JSON.stringify(users, null, 2);
  const blob = new Blob([data], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "avd_users.json"; a.click();
  URL.revokeObjectURL(url);
}

function importPrompt(){
  const txt = prompt("Paste JSON users di sini (array JSON)");
  if(!txt) return;
  try{
    const parsed = JSON.parse(txt);
    if(!Array.isArray(parsed)) throw "not array";
    // basic shape check
    parsed.forEach(u=>{
      if(!u.user || !u.pass || !u.level) throw "invalid format";
    });
    saveUsersToStorage(parsed);
    renderUsersTable();
    alert("Import berjaya");
  }catch(e){
    alert("Import gagal: " + e);
  }
}

/* ================ DASHBOARD (kept from original) ================ */
function setupDashboard(){
  const form=document.getElementById("telegramForm");
  const typeSelect=document.getElementById("type");
  const inputArea=document.getElementById("inputArea");
  const statusEl=document.getElementById("status");

  typeSelect.addEventListener("change",()=>{
    const type=typeSelect.value;let html="";
    switch(type){
      case "text":
        html=`<label for="text">mt:</label><br><textarea id="text" rows="5" placeholder="Tulis MT di sini..." required></textarea>`;
        break;
      case "photo":
        html=`<label for="photo">URL Gambar:</label><br><input id="photo" type="url" placeholder="https://..." required>`;
        break;
      case "sticker":
        html=`<label for="sticker">Sticker ID:</label><br><input id="sticker" type="text" placeholder="Masukkan Sticker ID" required>`;
        break;
      case "voice":
        html=`<label for="voice">Voice URL:</label><br><input id="voice" type="url" placeholder="https://..." required>`;
        break;
      case "document":
        html=`<label for="document">Document URL:</label><br><input id="document" type="url" placeholder="https://..." required>`;
        break;
      case "location":
        html=`<label for="location">Lokasi:</label><br><input id="location" type="text" placeholder="contoh: 3.139,101.6869" required>`;
        break;
      default:
        html=`<label for="text">Keterangan:</label><br><textarea id="text" rows="5" placeholder="Tulis Teks di sini..." required></textarea>`;
    }
    inputArea.innerHTML=html;
  });

  (function ensureDefaultInput(){
    const evt = new Event('change');
    typeSelect.dispatchEvent(evt);
  })();

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    if(!localStorage.getItem("avd_login")){
      statusEl.textContent = "‚ö†Ô∏è Token belum dimasukkan!";
      statusEl.style.color = "orange";
      return;
    }
    const chat_id = document.getElementById("chat_id").value.trim();
    if(!chat_id){
      statusEl.textContent = "‚ùå Sila masukkan ID target.";
      statusEl.style.color = "red";
      return;
    }

    const type = typeSelect.value;
    const jumlah = Math.max(1, parseInt(document.getElementById("jumlah").value) || 1);

    // enforce limits by level
    const level = localStorage.getItem("avd_level");
    if(level === "TRIAL" && jumlah > 1){
      statusEl.textContent = "‚ùå Trial hanya boleh 1x!";
      statusEl.style.color = "red";
      return;
    }
    if(level === "VIP" && jumlah > 50){
      statusEl.textContent = "‚ùå VIP had 50";
      statusEl.style.color = "red";
      return;
    }

    statusEl.textContent = "‚è≥ Menghantar...";
    statusEl.style.color = "#ff0000";

    const apiBase = `https://api.telegram.org/bot${botToken}/`;
    let success = 0, fail = 0;

    for(let i=0;i<jumlah;i++){
      try{
        let resp;
        if(type === "text"){
          const text = document.getElementById("text").value;
          resp = await fetch(apiBase + "sendMessage", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ chat_id, text })
          });
        } else if(type === "photo"){
          const photo = document.getElementById("photo").value;
          resp = await fetch(apiBase + "sendPhoto", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ chat_id, photo })
          });
        } else if(type === "sticker"){
          const sticker = document.getElementById("sticker").value;
          resp = await fetch(apiBase + "sendSticker", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ chat_id, sticker })
          });
        } else if(type === "voice"){
          const voice = document.getElementById("voice").value;
          resp = await fetch(apiBase + "sendVoice", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ chat_id, voice })
          });
        } else if(type === "document"){
          const doc = document.getElementById("document").value;
          resp = await fetch(apiBase + "sendDocument", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ chat_id, document: doc })
          });
        } else if(type === "location"){
          const loc = document.getElementById("location").value.split(",").map(s => s.trim());
          const latitude = parseFloat(loc[0]);
          const longitude = parseFloat(loc[1]);
          resp = await fetch(apiBase + "sendLocation", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ chat_id, latitude, longitude })
          });
        } else {
          resp = await fetch(apiBase + "sendMessage", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ chat_id, text: "No type selected" })
          });
        }

        const result = await resp.json();
        if(result && result.ok){ success++; } else { fail++; console.error(result); }
      } catch(err){
        fail++; console.error(err);
      }
    }

    if(fail === 0){
      statusEl.textContent = `‚úÖ SUCSES ATACK (${success}) berjaya dihantar!`;
      statusEl.style.color = "lightgreen";
    } else {
      statusEl.textContent = `‚ö†Ô∏è ${success} berjaya, ${fail} gagal.`;
      statusEl.style.color = "orange";
    }
  });
}

/* =============== Small helpers =============== */
function saveToken(){
  const input=document.getElementById("tokenInput").value.trim();
  const status=document.getElementById("statusToken");
  if(input){botToken=input;status.textContent="‚úÖ Bot Token berjaya diaktifkan!";status.style.color="lightgreen";}
  else{status.textContent="‚ö†Ô∏è Sila masukkan token yang sah.";status.style.color="orange";}
}

/* =============== INIT: hide home auto-load (require login) =============== */
// Note: do not auto load home; login required
// loadPage("home"); // disabled to enforce login

</script>
</body>
</html>
